<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Cirkel verdelen in punten</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #ffffff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #circleCanvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    .controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #cccccc;
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      flex-wrap: wrap;
      max-width: 450px;
    }

    .controls input[type="number"] {
      width: 80px;
      padding: 4px;
      font-size: 13px;
    }

    .controls button {
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #333333;
      background: #f5f5f5;
    }

    .controls button:hover {
      filter: brightness(0.95);
    }

    .toggle-group {
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .controls input[type="file"] {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <label for="pointsInput">Aantal punten:</label>
    <input type="number" id="pointsInput" min="1" value="24" />

    <button id="generateBtn">Genereer</button>
    <button id="saveBtn">Sla op</button>

    <div class="toggle-group">
      <input type="checkbox" id="pieCheckbox" />
      <label for="pieCheckbox">Regenboog taartpunten</label>
    </div>

    <div class="toggle-group">
      <input type="checkbox" id="transparentCheckbox" />
      <label for="transparentCheckbox">Achtergrond transparant</label>
    </div>

    <div>
      <label for="textFileInput">Teksten (.txt):</label>
      <input type="file" id="textFileInput" accept=".txt" />
    </div>
  </div>

  <canvas id="circleCanvas"></canvas>

  <script>
    const canvas = document.getElementById("circleCanvas");
    const ctx = canvas.getContext("2d");

    const pointsInput = document.getElementById("pointsInput");
    const generateBtn = document.getElementById("generateBtn");
    const saveBtn = document.getElementById("saveBtn");
    const pieCheckbox = document.getElementById("pieCheckbox");
    const transparentCheckbox = document.getElementById("transparentCheckbox");
    const textFileInput = document.getElementById("textFileInput");

    let usePie = false;
    let useTransparentBackground = false;
    let labels = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      drawCircle();
    }

    window.addEventListener("resize", resizeCanvas);

    pieCheckbox.addEventListener("change", () => {
      usePie = pieCheckbox.checked;
      drawCircle();
    });

    transparentCheckbox.addEventListener("change", () => {
      useTransparentBackground = transparentCheckbox.checked;
      drawCircle();
    });

    textFileInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) {
        return;
      }
      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;
        labels = content
          .split(/\r?\n/)
          .map(line => line.trim())
          .filter(line => line.length > 0);
        drawCircle();
      };
      reader.readAsText(file, "utf-8");
    });

    function drawCircle() {
      const n = parseInt(pointsInput.value, 10);

      if (!Number.isFinite(n) || n < 1) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const dim = Math.min(canvas.width, canvas.height);
      const offsetX = (canvas.width - dim) / 2;
      const offsetY = (canvas.height - dim) / 2;
      const cx = offsetX + dim / 2;
      const cy = offsetY + dim / 2;
      const radius = dim / 2 - 10;

      if (!useTransparentBackground) {
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      ctx.lineWidth = 2;
      ctx.strokeStyle = "#000000";

      const rainbow = [
        "#FF0000",
        "#FF7F00",
        "#FFFF00",
        "#00FF00",
        "#0000FF",
        "#4B0082",
        "#8B00FF"
      ];

      if (usePie) {
        for (let i = 0; i < n; i++) {
          const startAngle = (i / n) * Math.PI * 2;
          const endAngle = ((i + 1) / n) * Math.PI * 2;
          const color = rainbow[i % rainbow.length];

          // Taartpunt
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.arc(cx, cy, radius, startAngle, endAngle);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
          ctx.stroke();

          // Tekst in de taartpunt (indien labels aanwezig)
          if (labels.length > 0) {
            const text = labels[i % labels.length];
            const midAngle = (startAngle + endAngle) / 2;

            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(midAngle);

            const fontSize = Math.max(14, radius * 0.10);
            ctx.font = `bold ${fontSize}px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;
            ctx.fillStyle = "#000000";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";

            // Plaats tekst richting centrum
            const textRadius = radius * 0.6;
            // we draaien de tekst zodat hij grofweg naar het centrum gericht is
            ctx.translate(0, -textRadius);
            ctx.rotate(Math.PI);

            ctx.fillText(text, 0, 0);
            ctx.restore();
          }
        }

        // Rand van de cirkel
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI * 2);
        ctx.stroke();
      } else {
        // Gewone cirkel met lijnen vanuit het middelpunt
        if (!useTransparentBackground) {
          // achtergrond is al gevuld, dus alleen cirkel en lijnen
        }
        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, Math.PI * 2);
        ctx.stroke();

        for (let i = 0; i < n; i++) {
          const angle = (i / n) * Math.PI * 2;
          const x = cx + radius * Math.cos(angle);
          const y = cy + radius * Math.sin(angle);

          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.lineTo(x, y);
          ctx.stroke();
        }
      }
    }

    function drawSquareExport(ctxExport, size, n) {
      ctxExport.clearRect(0, 0, size, size);

      const cx = size / 2;
      const cy = size / 2;
      const radius = size / 2 - 10;

      if (!useTransparentBackground) {
        ctxExport.fillStyle = "#ffffff";
        ctxExport.fillRect(0, 0, size, size);
      }

      ctxExport.lineWidth = 2;
      ctxExport.strokeStyle = "#000000";

      const rainbow = [
        "#FF0000",
        "#FF7F00",
        "#FFFF00",
        "#00FF00",
        "#0000FF",
        "#4B0082",
        "#8B00FF"
      ];

      if (usePie) {
        for (let i = 0; i < n; i++) {
          const startAngle = (i / n) * Math.PI * 2;
          const endAngle = ((i + 1) / n) * Math.PI * 2;
          const color = rainbow[i % rainbow.length];

          ctxExport.beginPath();
          ctxExport.moveTo(cx, cy);
          ctxExport.arc(cx, cy, radius, startAngle, endAngle);
          ctxExport.closePath();
          ctxExport.fillStyle = color;
          ctxExport.fill();
          ctxExport.stroke();

          if (labels.length > 0) {
            const text = labels[i % labels.length];
            const midAngle = (startAngle + endAngle) / 2;

            ctxExport.save();
            ctxExport.translate(cx, cy);
            ctxExport.rotate(midAngle);

            const fontSize = Math.max(14, radius * 0.10);
            ctxExport.font = `bold ${fontSize}px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;
            ctxExport.fillStyle = "#000000";
            ctxExport.textAlign = "center";
            ctxExport.textBaseline = "middle";

            const textRadius = radius * 0.6;
            ctxExport.translate(0, -textRadius);
            ctxExport.rotate(Math.PI);

            ctxExport.fillText(text, 0, 0);
            ctxExport.restore();
          }
        }

        ctxExport.beginPath();
        ctxExport.arc(cx, cy, radius, 0, Math.PI * 2);
        ctxExport.stroke();
      } else {
        ctxExport.beginPath();
        ctxExport.arc(cx, cy, radius, 0, Math.PI * 2);
        ctxExport.stroke();

        for (let i = 0; i < n; i++) {
          const angle = (i / n) * Math.PI * 2;
          const x = cx + radius * Math.cos(angle);
          const y = cy + radius * Math.sin(angle);

          ctxExport.beginPath();
          ctxExport.moveTo(cx, cy);
          ctxExport.lineTo(x, y);
          ctxExport.stroke();
        }
      }
    }

    generateBtn.addEventListener("click", drawCircle);

    pointsInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        drawCircle();
      }
    });

    saveBtn.addEventListener("click", () => {
      const n = parseInt(pointsInput.value, 10);
      if (!Number.isFinite(n) || n < 1) {
        return;
      }

      const size = Math.min(window.innerWidth, window.innerHeight);
      const exportCanvas = document.createElement("canvas");
      exportCanvas.width = size;
      exportCanvas.height = size;
      const exportCtx = exportCanvas.getContext("2d");

      drawSquareExport(exportCtx, size, n);

      const safeN = Number.isFinite(n) && n > 0 ? n : "onbekend";
      const link = document.createElement("a");

      if (useTransparentBackground) {
        link.download = `cirkel_${safeN}_punten.png`;
        link.href = exportCanvas.toDataURL("image/png");
      } else {
        link.download = `cirkel_${safeN}_punten.jpg`;
        link.href = exportCanvas.toDataURL("image/jpeg", 0.95);
      }

      link.click();
    });

    resizeCanvas();
  </script>
</body>
</html>
